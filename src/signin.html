<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>SkillTracker | Authorization</title>

    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap");

      body {
        font-family: "Inter", sans-serif;
        background: #000;
        color: #fff;
        overflow: hidden;
      }

      .glass {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(30px);
        border: 1px solid rgba(255, 255, 255, 0.06);
        transition: all 0.6s cubic-bezier(0.16, 1, 0.3, 1);
      }

      .input {
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.08);
        transition: all 0.3s ease;
      }

      .input:focus {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.3);
        outline: none;
      }

      .squircle {
        border-radius: 20px;
      }

      /* ANIMATIONS */

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      .loader {
        width: 20px;
        height: 20px;
        border: 2px solid rgba(0, 0, 0, 0.2);
        border-top-color: #000;
        border-radius: 50%;
        animation: spin 0.6s linear infinite;
        display: inline-block;
      }

      /* Success Transition State */
      .page-exit {
        opacity: 0;
        transform: scale(0.95) translateY(-20px);
        filter: blur(10px);
      }

      button:disabled {
        opacity: 0.7;
        cursor: not-allowed;
      }
    </style>
  </head>

  <body class="min-h-screen flex items-center justify-center">
    <div id="mainContent" class="w-full max-w-md transition-all duration-700">
      <h1
        id="title"
        class="text-5xl font-black mb-6 transition-all duration-500"
      >
        WELCOME <span class="text-white/20 italic">BACK.</span>
      </h1>

      <div class="glass p-10 squircle" id="formCard">
        <form id="signinForm" class="space-y-5">
          <input
            id="signinEmail"
            type="email"
            placeholder="Email"
            required
            class="input w-full px-4 py-4 squircle"
          />

          <input
            id="signinPassword"
            type="password"
            placeholder="Password"
            required
            class="input w-full px-4 py-4 squircle"
          />

          <button
            id="signinBtn"
            class="w-full bg-white text-black py-4 squircle font-bold flex items-center justify-center gap-2 hover:bg-gray-200 transition-colors"
          >
            <span class="btn-text">SIGN IN →</span>
          </button>
        </form>

        <form id="signupForm" class="space-y-5 hidden">
          <input
            id="signupName"
            placeholder="Name"
            required
            class="input w-full px-4 py-4 squircle"
          />

          <input
            id="signupEmail"
            type="email"
            placeholder="Email"
            required
            class="input w-full px-4 py-4 squircle"
          />

          <input
            id="signupPassword"
            type="password"
            placeholder="Password"
            required
            class="input w-full px-4 py-4 squircle"
          />

          <button
            id="signupBtn"
            class="w-full bg-white text-black py-4 squircle font-bold flex items-center justify-center gap-2 hover:bg-gray-200 transition-colors"
          >
            <span class="btn-text">CREATE ACCOUNT →</span>
          </button>
        </form>

        <div class="mt-6 text-center">
          <button
            id="toggleBtn"
            class="text-white/40 hover:text-white text-sm transition-colors"
          >
            Create new account
          </button>
        </div>
      </div>
    </div>

    <script>
      const API = "https://st-v01.onrender.com";
      let mode = "signin";

      const signinForm = document.getElementById("signinForm");
      const signupForm = document.getElementById("signupForm");
      const toggleBtn = document.getElementById("toggleBtn");
      const title = document.getElementById("title");
      const mainContent = document.getElementById("mainContent");

      /* UI HELPERS */

      const setButtonLoading = (formId, isLoading) => {
        const btn = document.querySelector(`#${formId} button`);
        const text = btn.querySelector(".btn-text");
        const originalText =
          mode === "signin" ? "SIGN IN →" : "CREATE ACCOUNT →";

        if (isLoading) {
          btn.disabled = true;
          text.innerHTML = '<span class="loader"></span>';
        } else {
          btn.disabled = false;
          text.innerText = originalText;
        }
      };

      const handleSuccess = () => {
        mainContent.classList.add("page-exit");
        setTimeout(() => {
          window.location = "dashboard.html";
        }, 600);
      };

      /* SWITCH VIEW */

      toggleBtn.onclick = () => {
        // Simple fade effect during switch
        formCard.style.opacity = "0";

        setTimeout(() => {
          if (mode === "signin") {
            mode = "signup";
            signinForm.classList.add("hidden");
            signupForm.classList.remove("hidden");
            title.innerHTML =
              "INITIALIZE <span class='text-white/20 italic'>IDENTITY.</span>";
            toggleBtn.innerText = "Already have account";
          } else {
            mode = "signin";
            signupForm.classList.add("hidden");
            signinForm.classList.remove("hidden");
            title.innerHTML =
              "WELCOME <span class='text-white/20 italic'>BACK.</span>";
            toggleBtn.innerText = "Create new account";
          }
          formCard.style.opacity = "1";
        }, 200);
      };

      /* SIGNIN SUBMIT */

      signinForm.onsubmit = async (e) => {
        e.preventDefault();
        setButtonLoading("signinForm", true);

        try {
          const res = await fetch(API + "/auth/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              email: signinEmail.value,
              password: signinPassword.value,
            }),
          });

          const data = await res.json();

          if (res.ok) {
            localStorage.setItem("accessToken", data.accessToken);
            localStorage.setItem("refreshToken", data.refreshToken);
            handleSuccess();
          } else {
            setButtonLoading("signinForm", false);
            alert(data.error || "Login failed");
          }
        } catch (err) {
          setButtonLoading("signinForm", false);
          alert("Network error. Check your connection.");
        }
      };

      /* SIGNUP SUBMIT */

      signupForm.onsubmit = async (e) => {
        e.preventDefault();
        setButtonLoading("signupForm", true);

        try {
          const res = await fetch(API + "/auth/signup", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              name: signupName.value,
              email: signupEmail.value,
              password: signupPassword.value,
            }),
          });

          const data = await res.json();

          if (res.ok) {
            localStorage.setItem("accessToken", data.accessToken);
            localStorage.setItem("refreshToken", data.refreshToken);
            handleSuccess();
          } else {
            setButtonLoading("signupForm", false);
            alert(data.error || "Signup failed");
          }
        } catch (err) {
          setButtonLoading("signupForm", false);
          alert("Network error. Check your connection.");
        }
      };
    </script>
  </body>
</html>
