<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Edit Profile</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-zinc-950 text-zinc-100 min-h-screen flex items-center justify-center">

  <div class="w-full max-w-md bg-zinc-900 rounded-xl shadow-lg p-6">
    <h1 class="text-xl font-semibold mb-4">Edit Profile</h1>

    <!-- Avatar Preview -->
    <div class="flex flex-col items-center gap-3 mb-6">
      <img
        id="avatarPreview"
        src="https://loremfaces.net/128/id/1.jpg"
        class="w-32 h-32 rounded-full object-cover border border-zinc-700"
      />
      <label class="cursor-pointer text-sm text-blue-400 hover:underline">
        Change Avatar
        <input
          type="file"
          accept="image/*"
          id="avatarInput"
          class="hidden"
        />
      </label>
    </div>

    <!-- Submit -->
    <button
      id="saveBtn"
      class="w-full bg-blue-600 hover:bg-blue-700 transition rounded-lg py-2 font-medium"
    >
      Save Changes
    </button>

    <!-- Status -->
    <p id="status" class="text-sm text-center mt-3"></p>
  </div>

<script>
  const avatarInput = document.getElementById("avatarInput");
  const avatarPreview = document.getElementById("avatarPreview");
  const saveBtn = document.getElementById("saveBtn");
  const statusText = document.getElementById("status");

  let selectedFile = null;

  // Preview image
  avatarInput.addEventListener("change", () => {
    const file = avatarInput.files[0];
    if (!file) return;

    selectedFile = file;
    avatarPreview.src = URL.createObjectURL(file);
  });

  saveBtn.addEventListener("click", async () => {
    if (!selectedFile) {
      statusText.textContent = "Please select an image first.";
      statusText.className = "text-red-400 text-sm text-center mt-3";
      return;
    }

    const formData = new FormData();
    formData.append("avatar", selectedFile);

    statusText.textContent = "Uploading...";
    statusText.className = "text-zinc-400 text-sm text-center mt-3";
    console.log(localStorage.getItem("token"))
    try {
      const response = await fetch("http://localhost:5500/user/update/profile/avatar", {
        method: "PUT",
        headers: {
          Authorization: `Bearer ${localStorage.getItem("accessToken")}`
        },
        body: formData
      });

      const data = await response.json();

      if (!response.ok) {
        throw new Error(data.message || "Upload failed");
      }

      avatarPreview.src = data.avatar;
      statusText.textContent = "Profile image updated successfully.";
      statusText.className = "text-green-400 text-sm text-center mt-3";

    } catch (err) {
      statusText.textContent = err.message;
      statusText.className = "text-red-400 text-sm text-center mt-3";
    }
  });
</script>

</body>
</html>
