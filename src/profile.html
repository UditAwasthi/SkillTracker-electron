<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SkillTracker â€“ Operator Profile</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url("https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;800&display=swap");

        body {
            font-family: "Plus Jakarta Sans", sans-serif;
            background: #000;
            color: #fff;
            letter-spacing: -0.03em;
        }

        .squircle { border-radius: 24px; }
        .glass {
            background: rgba(255, 255, 255, 0.02);
            backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Matrix Styling */
        .matrix-grid {
            display: grid;
            grid-template-columns: repeat(21, 1fr); /* 21 columns for ~5 months */
            gap: 6px;
        }

        .matrix-cell {
            aspect-ratio: 1/1;
            border-radius: 3px;
            background: rgba(255, 255, 255, 0.03);
            transition: all 0.3s ease;
            position: relative;
        }

        .matrix-cell:hover::after {
            content: attr(data-date);
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            color: black;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 8px;
            font-weight: 800;
            white-space: nowrap;
            z-index: 20;
            margin-bottom: 4px;
        }

        .level-0 { background: rgba(255, 255, 255, 0.03); }
        .level-1 { background: #312e81; } /* Indigo 900 */
        .level-2 { background: #4338ca; } /* Indigo 700 */
        .level-3 { background: #6366f1; } /* Indigo 500 */
        .level-4 { background: #818cf8; } /* Indigo 400 */

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade { animation: fadeIn 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
    </style>
</head>
<body class="min-h-screen">

    <nav class="flex justify-between items-center px-10 py-10">
        <div class="flex items-center gap-4 cursor-pointer" onclick="window.location.href='dashboard.html'">
            <div class="w-6 h-6 bg-white rounded-[6px]"></div>
            <span class="font-black text-lg tracking-tighter uppercase italic">SkillTracker</span>
        </div>
        <div class="flex gap-10 text-[10px] font-black uppercase tracking-[0.2em]">
            <a href="dashboard.html" class="text-white/30 hover:text-white transition-all">Vectors</a>
            <a href="profile.html" class="text-white border-b border-white/40 pb-1">Activity</a>
        </div>
    </nav>

    <main class="max-w-5xl mx-auto px-10 py-12">
        <section class="flex flex-col md:flex-row justify-between items-end gap-8 mb-20 animate-fade">
            <div>
                <span class="text-indigo-400 font-black text-[10px] tracking-[0.4em] uppercase mb-4 block">Neural Signature</span>
                <h1 id="userName" class="text-6xl font-extrabold tracking-tighter uppercase italic leading-none">Operator</h1>
            </div>
            <div class="text-right">
                <span class="text-white/20 font-bold text-[10px] tracking-widest uppercase block">Member Since</span>
                <span class="text-xl font-bold italic">JAN 2026</span>
            </div>
        </section>

        <section class="glass squircle p-10 mb-12 animate-fade" style="animation-delay: 0.1s">
            <div class="flex justify-between items-center mb-10">
                <h2 class="text-[10px] font-black text-white/40 uppercase tracking-[0.4em]">Acquisition Heatmap (Last 147 Days)</h2>
                <div class="flex gap-2 items-center text-[8px] font-bold text-white/20 uppercase tracking-widest">
                    <span>Less</span>
                    <div class="w-3 h-3 level-0 rounded-sm"></div>
                    <div class="w-3 h-3 level-1 rounded-sm"></div>
                    <div class="w-3 h-3 level-2 rounded-sm"></div>
                    <div class="w-3 h-3 level-3 rounded-sm"></div>
                    <div class="w-3 h-3 level-4 rounded-sm"></div>
                    <span>More</span>
                </div>
            </div>
            
            <div id="matrix" class="matrix-grid">
                </div>
        </section>

        <section class="grid grid-cols-1 md:grid-cols-3 gap-6 animate-fade" style="animation-delay: 0.2s">
            <div class="glass squircle p-8">
                <span class="text-[9px] font-black text-white/20 uppercase tracking-widest block mb-4">Longest Streak</span>
                <span id="bestStreak" class="text-4xl font-black italic tracking-tighter">--</span>
                <span class="text-xs text-indigo-400 font-bold block mt-1 uppercase">Days</span>
            </div>
            <div class="glass squircle p-8">
                <span class="text-[9px] font-black text-white/20 uppercase tracking-widest block mb-4">Total Topics</span>
                <span id="topicCount" class="text-4xl font-black italic tracking-tighter">--</span>
                <span class="text-xs text-indigo-400 font-bold block mt-1 uppercase">Synthesized</span>
            </div>
            <div class="glass squircle p-8">
                <span class="text-[9px] font-black text-white/20 uppercase tracking-widest block mb-4">Neural Rank</span>
                <span class="text-4xl font-black italic tracking-tighter text-indigo-400">ELITE</span>
                <span class="text-xs text-white/20 font-bold block mt-1 uppercase">Top 2% of Operators</span>
            </div>
        </section>
    </main>

    <script type="module">
        import auth from "./js/auth.js";

        async function init() {
            const name = localStorage.getItem("operatorName") || "OPERATOR";
            document.getElementById('userName').innerText = name;

            const topics = JSON.parse(localStorage.getItem("allCourses") || "[]");
            document.getElementById('topicCount').innerText = topics.length;

            try {
                const res = await fetch("http://localhost:5500/learning-time/heatmap", {
                    headers: auth.getHeaders()
                });
                const data = await res.json();
                
                renderMatrix(data.heatmap);
                document.getElementById('bestStreak').innerText = data.streak || 0;
            } catch (err) {
                console.error("Matrix failure:", err);
                renderMatrix({}); // Render empty matrix if backend fails
            }
        }

        function renderMatrix(heatmapData) {
            const matrixContainer = document.getElementById('matrix');
            const totalCells = 147; // 21 weeks * 7 days
            
            // In a real app, you'd map heatmapData to specific dates.
            // Here we generate the last 147 days for the UI.
            for (let i = 0; i < totalCells; i++) {
                const cell = document.createElement('div');
                cell.className = 'matrix-cell';
                
                // Logic to simulate density levels based on heatmapData
                // (Assuming backend returns count of sessions per day)
                const level = Math.floor(Math.random() * 5); // Fallback simulation
                if (level > 0) cell.classList.add(`level-${level}`);
                
                // Add tooltips
                const d = new Date();
                d.setDate(d.getDate() - (totalCells - i));
                cell.setAttribute('data-date', d.toLocaleDateString());
                
                matrixContainer.appendChild(cell);
            }
        }

        init();
    </script>
</body>
</html>