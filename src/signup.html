<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SkillTracker | Initialize Identity</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&display=swap");

      body {
        font-family: "Inter", sans-serif;
        background-color: #000;
        color: #fff;
        letter-spacing: -0.03em;
      }

      .squircle {
        border-radius: 38px;
      }
      .input-squircle {
        border-radius: 20px;
      }

      .glass {
        background: rgba(255, 255, 255, 0.03);
        backdrop-filter: blur(30px);
        border: 1px solid rgba(255, 255, 255, 0.06);
      }

      .input-field {
        background: rgba(255, 255, 255, 0.02);
        border: 1px solid rgba(255, 255, 255, 0.08);
        transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);
      }

      .input-field:focus {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.3);
        outline: none;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(15px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .animate-ui {
        animation: fadeIn 1.2s cubic-bezier(0.16, 1, 0.3, 1) forwards;
      }
    </style>
  </head>

  <body
    class="antialiased min-h-screen flex flex-col justify-between overflow-hidden"
  >
    <nav class="flex justify-between items-center px-10 py-8">
      <div class="flex items-center gap-3">
        <div class="w-5 h-5 bg-white rounded-[5px]"></div>
        <span class="font-bold text-sm">SkillTracker</span>
      </div>

      <div class="flex items-center gap-6">
        <span
          class="text-[11px] font-medium text-white/30 uppercase tracking-widest"
        >
          Operator Setup
        </span>
        <a
          href="signin.html"
          class="text-xs font-semibold text-white/50 hover:text-white"
        >
          Authorize Existing
        </a>
      </div>
    </nav>

    <main class="px-10 flex-1 flex items-center justify-center">
      <div class="w-full max-w-[420px] animate-ui">
        <div class="mb-10">
          <h1
            class="text-5xl font-extrabold tracking-tighter leading-none mb-4"
          >
            INITIALIZE <br />
            <span class="text-white/20 italic">IDENTITY.</span>
          </h1>
          <p class="text-white/40 text-sm">
            Register your neural signature to begin acquisition.
          </p>
        </div>

        <div class="glass squircle p-10">
          <form id="signupForm" class="space-y-5">
            <div>
              <label
                class="block text-[10px] font-bold text-white/20 uppercase tracking-widest mb-2"
              >
                Operator Name
              </label>
              <input
                id="name"
                required
                class="input-field w-full px-5 py-4 input-squircle text-sm"
                placeholder="Udit"
              />
            </div>

            <div>
              <label
                class="block text-[10px] font-bold text-white/20 uppercase tracking-widest mb-2"
              >
                Network Email
              </label>
              <input
                id="email"
                type="email"
                required
                class="input-field w-full px-5 py-4 input-squircle text-sm"
                placeholder="udit@example.com"
              />
            </div>

            <div>
              <label
                class="block text-[10px] font-bold text-white/20 uppercase tracking-widest mb-2"
              >
                Access Key
              </label>
              <input
                id="password"
                type="password"
                required
                class="input-field w-full px-5 py-4 input-squircle text-sm"
                placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
              />
            </div>

            <!-- ðŸ”‘ AI API KEY (BETA ONLY) -->
            <div>
              <label
                class="block text-[10px] font-bold text-white/20 uppercase tracking-widest mb-2"
              >
                AI API Key <span class="text-white/30"></span>
              </label>
              <input
                id="aiApiKey"
                type="password"
                class="input-field w-full px-5 py-4 input-squircle text-sm"
                placeholder="Groq API key"
              />
              <p class="text-[10px] text-white/30 mt-2">
                Stored securely. Never exposed or returned.
                <button id="getGroqKey" class="text-white hover:underline ml-1">
                  Generate Groq API Key
                </button>
              </p>
            </div>

            <button
              id="submitBtn"
              class="w-full bg-white text-black py-4 input-squircle font-black text-xs uppercase tracking-widest hover:bg-neutral-200 transition"
            >
              Establish Identity â†’
            </button>
          </form>

          <div class="mt-8 text-center">
            <p
              class="text-[10px] font-bold text-white/20 uppercase tracking-widest"
            >
              Already Registered?
              <a href="signin.html" class="text-white hover:underline ml-1">
                Authorize Access
              </a>
            </p>
          </div>
        </div>
      </div>
    </main>

    <footer class="px-10 py-10 flex justify-between text-[10px] text-white/30">
      <span>Secure Vault Storage</span>
      <span>SkillTracker Engine Â· v1.0.4</span>
    </footer>

    <script type="module">
      document.getElementById("getGroqKey").onclick = () => {
        window.external.open("https://console.groq.com/keys");
      };
      const signupForm = document.getElementById("signupForm");
      const submitBtn = document.getElementById("submitBtn");

      signupForm.onsubmit = async (e) => {
        e.preventDefault();
        submitBtn.innerText = "INITIALIZING...";
        submitBtn.disabled = true;

        const payload = {
          name: document.getElementById("name").value.trim(),
          email: document.getElementById("email").value.trim(),
          password: document.getElementById("password").value,
          aiApiKey: document.getElementById("aiApiKey").value.trim() || null,
        };

        try {
          const res = await fetch("http://localhost:5500/auth/signup", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          const data = await res.json();

          if (res.ok) {
            localStorage.setItem("accessToken", data.accessToken);
            localStorage.setItem("operatorName", payload.name);
            window.location.href = "dashboard.html";
          } else if (res.status === 409) {
            alert("Identity already exists. Redirecting...");
            window.location.href = "signin.html";
          } else {
            alert(data.error || "Initialization failed");
            resetBtn();
          }
        } catch {
          alert("Protocol Error: Backend unreachable");
          resetBtn();
        }
      };

      function resetBtn() {
        submitBtn.innerText = "Establish Identity â†’";
        submitBtn.disabled = false;
      }
    </script>
  </body>
</html>
